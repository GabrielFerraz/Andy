class DialogBox {      game: Level;     dialogs: any;     dialog: any;     dialogSprite: Phaser.Sprite;     dialogSection: any;     letterIndex: number;     text: Phaser.Text;      endCb: Function;     letterTimer: Phaser.TimerEvent;     isRunning: boolean;      constructor(game: Level) {         this.game = game;         this.dialogs = this.game.cache.getJSON('dialogs');     }      startDialog(dialogId: string, endCallback: Function) {         if (!this.isRunning) this.isRunning = true;         this.dialogSprite = this.game.overlayLayer.create(20, 400, 'dialogBox');         this.dialogSprite.inputEnabled = true;         this.dialogSprite.events.onInputDown.add(this.click, this);          this.dialog = this.dialogs[dialogId];          this.text = this.game.add.text(50, 430, '', { font: "25px 'Alphbeta'", fill: "#fff" }, this.game.overlayLayer);         //this.game.foregroundLayer.addChild(this.text);         this.endCb = endCallback;          this.nextSection(this.dialog.start);      }      nextSection(id) {         if (!id) {             this.endDialog();             return;         }          this.dialogSection = this.dialog.sections[id];          this.text.text = this.text.text.concat(this.dialogSection.name + "\n");         this.letterIndex = 0;          this.letterTimer = this.game.time.events.repeat(30, this.dialogSection.text.length, this.nextLetter, this);     }      nextLetter() {          this.text.text = this.text.text.concat(this.dialogSection.text[this.letterIndex]);           this.letterIndex++;          if (this.letterIndex === this.dialogSection.text.length) {             this.game.time.events.remove(this.letterTimer);         }             }      endDialog() {         this.dialogSprite.destroy();         this.text.destroy();         this.isRunning = false;         this.endCb(this.game);     }      click() {         if (this.letterIndex === this.dialogSection.text.length) {             this.text.text = '';             this.nextSection(this.dialogSection.next);             return;         }          this.game.time.events.remove(this.letterTimer);          this.text.text = this.text.text.concat(this.dialogSection.text.slice(this.letterIndex));         this.letterIndex = this.dialogSection.text.length;     }   }